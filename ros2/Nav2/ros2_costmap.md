
# 📚 ROS 2 : Costmap 

---

## 🧵  Costmap 이란? 
- 로봇 주변 환경의 장애물 및 이동 가능 지역을 2D 그리드 맵으로 표현한 것
- 네비게이션, 경로 계획, 장애물 회피 등에 활용 됨
- 각 셀(Cell)은 특정 비용(Cost)을 가지며, 이 값으로 장애물 유무나 통과 가능성 판단.

---

## 🧾 Global Costmap vs Local Costmap

| 구분            | Global Costmap                    | Local Costmap                     |
|----------------|----------------------------------|----------------------------------|
| 목적            | 전체 경로 계획 (Path Planning)     | 짧은 거리, 실시간 경로 수정 (Obstacle Avoidance) |
| 범위            | 전체 맵 (넓은 영역)                | 로봇 주변 한정 (좁은 영역)        |
| 업데이트 주기    | 느림 (저빈도)                     | 빠름 (고빈도)                     |
| 사용 노드        | `nav2_global_costmap`              | `nav2_local_costmap`              |
| 주요 사용 시점   | 장거리 목표로의 전체 경로 설정    | 장애물 회피 및 세밀한 제어        |

---

## 🎈 Costmap Layers

- Costmap은 여러 Layer로 구성되어 환경 정보를 세분화해서 관리함

1. Static Layer 
   - 고정된 장애물 정보 (예: 지도에서 가져온 벽, 장애물)  
   - 일반적으로 기존 맵 파일(.pgm, .yaml)에서 불러옴  

2. Obstacle Layer
   - 실시간으로 센서(LiDAR, 카메라) 데이터를 통해 동적 장애물 반영  
   - 로봇 주변에 새로 생긴 장애물을 감지  

3. Inflation Layer
   - 장애물 주변에 안전 거리를 확보하기 위한 가상 비용 부여  
   - 장애물 가까이 갈수록 높은 비용, 멀어질수록 비용 감소  
   - 로봇 충돌 방지를 위한 안전 영역 생성  

4. Voxel Layer (3D 지원 시)
   - 3차원 공간에서 장애물 표현 시 사용  
   - 드론이나 복잡한 환경에서 활용됨  

5. Costmap Filter Layer (Optional)
   - 특정 지역에 대해 속도 제한, 금지 영역 설정 등 추가적인 규칙 적용  
   - 예: 좁은 통로에서는 저속 주행, 특정 지역 통과 금지  

---

## 👑 Costmap 데이터 해석

| Cost 값 | 의미         |
|---------|--------------|
| 0       | Free Space (이동 가능) |
| 1~254   | Inflation Zone (위험도/비용) |
| 255     | Lethal Obstacle (치명적 장애물) |
| -1      | Unknown (탐색되지 않은 지역)  |

---
